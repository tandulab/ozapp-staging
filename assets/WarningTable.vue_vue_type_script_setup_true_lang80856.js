import{aj as _e,d as re,o as n,e as $,w as m,i as ge,G as be,c as v,a as r,f as l,k as y,t as f,u as c,v as G,C as _,r as h,ai as he,j as ye,y as we,b as xe,z as ke,F as Ce,ae as Ve,ak as Se,q as ie,x as $e,D as De,T as ze}from"../index80856.js";import{b as ue,u as Fe,T,L as Me,a as Te,s as Ue}from"./LazyDataTable80856.js";import{a as We}from"./index808566.js";import{a as Pe,s as qe}from"./index808567.js";import{s as Oe}from"./index808563.js";import{d as J,b as Le}from"./date80856.js";import{u as je}from"./user80856.js";import{u as de}from"./settings80856.js";function Ee(o){_e.config.globalProperties.$confirm.require({header:o.header,group:"confirm-dialog",message:o.message,accept(){var s;(s=o.acceptCallback)==null||s.call(o)},reject(){var s;(s=o.rejectCallback)==null||s.call(o)}})}const Be={key:0,class:"mb-5"},Ne={key:1,class:"mb-5"},Ae={key:2,class:"mb-5"},Qe={class:"mb-5 flex flex-col"},Re={class:"mb-5 flex flex-col"},Ge={class:"mb-5 flex flex-col"},Ie={class:"mb-5 flex flex-col"},He={key:3,class:"mb-5 flex flex-col"},Ke=re({__name:"WarningDetailDialog",props:{item:Object,visible:Boolean},emits:["update:visible"],setup(o,{emit:p}){const s=de(),D=p;function x(){D("update:visible",!1)}return(X,a)=>{const w=ge("router-link"),I=ue,g=be;return n(),$(g,{visible:o.visible,modal:"",style:{width:"25rem"},header:"Dettaglio segnalazione",class:"m-w-[450px]",closable:!0,"onUpdate:visible":a[0]||(a[0]=z=>x())},{default:m(()=>{var z,O,L,j,E,B,N,F,A,M,U,k,W,b,Q;return[(z=o.item)!=null&&z.warning_user?(n(),v("div",Be,[a[1]||(a[1]=r("p",{class:"mb-0! uppercase text-sm font-bold"},"Utente segnalato:",-1)),l(w,{class:"hover:text-primary",to:{name:c(G).utentiDettaglio,params:{id:(L=(O=o.item)==null?void 0:O.warning_user)==null?void 0:L.id}}},{default:m(()=>{var C,V;return[y(f((V=(C=o.item)==null?void 0:C.warning_user)==null?void 0:V.full_name),1)]}),_:1},8,["to"])])):_("",!0),(j=o.item)!=null&&j.warning_video_id?(n(),v("div",Ne,[a[3]||(a[3]=r("p",{class:"mb-0! uppercase text-sm font-bold"},"Media segnalato:",-1)),l(w,{class:"hover:text-primary",to:{name:c(G).mediaDettaglio,params:{id:(E=o.item)==null?void 0:E.warning_video_id}}},{default:m(()=>a[2]||(a[2]=[y("-")])),_:1},8,["to"])])):_("",!0),(B=o.item)!=null&&B.warning_comment_id?(n(),v("div",Ae,[a[4]||(a[4]=r("p",{class:"mb-0! uppercase text-sm font-bold"},"Commento segnalato:",-1)),y(" "+f((N=o.item.warning_comment)==null?void 0:N.text),1)])):_("",!0),r("div",Qe,[a[5]||(a[5]=r("p",{class:"mb-0! uppercase text-sm font-bold"}," Segnalazione aperta da: ",-1)),l(w,{class:"hover:text-primary",to:{name:c(G).utentiDettaglio,params:{id:(A=(F=o.item)==null?void 0:F.user)==null?void 0:A.id}}},{default:m(()=>{var C,V;return[y(f((V=(C=o.item)==null?void 0:C.user)==null?void 0:V.full_name),1)]}),_:1},8,["to"])]),r("div",Re,[a[6]||(a[6]=r("p",{class:"mb-0! uppercase text-sm font-bold"}," Motivo della segnalazione: ",-1)),y(" "+f(((M=o.item)==null?void 0:M.warning_note)||"-"),1)]),r("div",Ge,[a[7]||(a[7]=r("p",{class:"mb-1! uppercase text-sm font-bold"}," Stato della segnalazione: ",-1)),r("div",null,[l(I,{value:c(s).getPrettyWarningStatus((U=o.item)==null?void 0:U.open),severity:c(s).getColorVideoStatus(!((k=o.item)!=null&&k.open))},null,8,["value","severity"])])]),r("div",Ie,[a[8]||(a[8]=r("p",{class:"mb-0! uppercase text-sm font-bold"}," Data apertura segnalazione: ",-1)),y(" "+f(c(J)((W=o.item)==null?void 0:W.created_at)),1)]),(b=o.item)!=null&&b.closed_at?(n(),v("div",He,[a[9]||(a[9]=r("p",{class:"mb-0! uppercase text-sm font-bold"}," Data chiusura segnalazione: ",-1)),y(" "+f(c(J)((Q=o.item)==null?void 0:Q.closed_at)),1)])):_("",!0)]}),_:1},8,["visible"])}}}),Je={key:0,class:"flex flex-col mb-8"},Xe=["onClick"],Ye={key:1,class:"crop"},Ze={key:2,class:"truncate overflow-hidden text-ellipsis w-[200px]"},et={key:0},tt={key:1},ot={key:2},at=["onClick"],st={class:"flex items-center justify-center"},lt={key:1,class:"w-[35px] h-[35px]"},it={class:"flex items-center justify-center"},ne=10,ft=re({__name:"WarningTable",props:{video_id:{},user_id:{}},setup(o){const p=o,s=h(),D=h(),x=h([{name:"Utenti",code:"user"},{name:"Media",code:"video"},{name:"Commenti",code:"comment"}]),X=h([{label:"Aperta",value:!0},{label:"Chiusa",value:!1}]),a=h(!1),w=he(),I=je(),g=de(),z=Ve(),O=Se(),{warnings:L,totalWarnings:j}=ye(w),{onSort:E,onPage:B,onFilter:N,loadLazyData:F,isLoading:A}=Fe({rows:ne},C),M=h(!1),U=h(),k=h(void 0),W=we(()=>I.users),b=h({id:{value:"",matchMode:T.EQ},user_id:{value:"",matchMode:T.EQ},open:{value:"",matchMode:T.EQ},created_at:{value:null,matchMode:T.GTE},warning_type:{value:"",matchMode:T.EQ},warning_user_id:{value:"",matchMode:T.EQ}});function Q(){N(b.value)}async function C(t){var u;try{if(p.video_id&&t.set("warning_video_id_eq",p.video_id),p.user_id&&t.set("warning_user_id_eq",p.user_id),b.value.user_id.value&&t.set("user_id_eq",b.value.user_id.value.id),(u=s==null?void 0:s.value)!=null&&u.code)switch(s.value.code){case"user":t.set("warning_user_id_neq","null");break;case"video":t.set("warning_video_id_neq","null");break;case"comment":t.set("warning_comment_id_neq","null");break}else!p.video_id&&!p.user_id&&t.set("warning_user_id_neq","null");b.value.created_at.value&&(t=Le(t,"created_at",b.value.created_at.value)),await w.fetchWarnings(t)}catch(P){console.error(P)}}async function V(t){try{await w.closeWarning(t),F(),De("Segnalazione chiusa con successo"),await w.fetchWarningsCounter()}catch(u){console.error(u)}}const Y=t=>{setTimeout(()=>{t.query.trim().length?D.value=W.value.filter(u=>u.full_name.toLowerCase().startsWith(t.query.toLowerCase())):D.value=[...W.value]},250)};function Z(){switch(s.value.code){case"video":k.value=g.getVideoWarningTypes()||[];break;case"comment":k.value=g.getCommentWarningTypes();break;case"user":k.value=g.getUserWarningTypes();break}}function ee(){const t=z.fullPath;switch(!0){case t.includes("/commenti"):s.value=x.value[2],a.value=!0;break;case t.includes("/utenti"):s.value=x.value[0],a.value=!0;break;case t.includes("/media"):s.value=x.value[1],a.value=!0;break;default:s.value=x.value[0],a.value=!1;break}}function ce(t){Ee({message:"Stai per chiudere la segnalazione. Vuoi confermare l'operazione?",header:"Chiudi segnalazione",acceptCallback(){V(t)}})}function me(t){U.value=t,M.value=!0}function te(t){O.push({name:G.utentiDettaglio,params:{id:t}})}return xe(()=>{ee(),Z()}),ke(()=>[p.video_id,p.user_id,z.fullPath],()=>{ee(),F()},{immediate:!0}),(t,u)=>{const P=Te,oe=Pe,R=Oe,pe=qe,S=Ue,ve=We,fe=ue,ae=$e,se=ze;return n(),v(Ce,null,[r("div",null,[!p.user_id&&!p.video_id&&!a.value?(n(),v("div",Je,[u[4]||(u[4]=r("label",{for:"warnings_type",class:"text-muted-color font-500 mb-1"},"Tipo di segnalazione",-1)),l(P,{modelValue:s.value,"onUpdate:modelValue":u[0]||(u[0]=e=>s.value=e),options:x.value,optionLabel:"name",class:"w-full md:w-60",onChange:u[1]||(u[1]=e=>{Z(),c(F)()})},null,8,["modelValue","options"])])):_("",!0),l(Me,{value:c(L),rows:ne,"total-records":c(j),onSort:c(E),onPage:c(B),onFilter:Q,filters:b.value,"onUpdate:filters":u[2]||(u[2]=e=>b.value=e),"data-key":"id",scrollable:"",loading:c(A),rowHover:!0,showGridlines:""},{empty:m(()=>u[5]||(u[5]=[y("Non ci sono segnalazioni")])),default:m(()=>[!t.user_id&&!t.video_id?(n(),$(S,{key:0,class:"min-w-[200px]","filter-field":"warning_user_id",header:s.value.code=="video"?"Media segnalato":s.value.code=="user"?"Utente segnalato":"Commento segnalato",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!0},{filter:m(({filterModel:e,filterCallback:d})=>[l(oe,{modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,optionLabel:"full_name",optionValue:"id",suggestions:D.value,onComplete:Y,onOptionSelect:i=>d(),dataKey:"id",onClear:i=>d()},null,8,["modelValue","onUpdate:modelValue","suggestions","onOptionSelect","onClear"])]),body:m(({data:e})=>{var d,i,q,H;return[e.warning_user_id?(n(),v("div",{key:0,class:"flex items-center gap-2 cursor-pointer",onClick:K=>{var le;return te(((le=e==null?void 0:e.warning_user)==null?void 0:le.id)??"")}},[(d=e.warning_user)!=null&&d.profile_picture_url?(n(),$(R,{key:0,image:(i=e.warning_user)==null?void 0:i.profile_picture_url,style:{width:"32px"},shape:"circle"},null,8,["image"])):e.warning_user?(n(),$(R,{key:1,class:"mr-2 text-sm!",size:"width: 32px",shape:"circle"})):_("",!0),r("span",null,f((q=e.warning_user)==null?void 0:q.full_name),1)],8,Xe)):_("",!0),e.warning_video?(n(),v("div",Ye,[l(pe,{src:(H=e.warning_video)==null?void 0:H.attachment_img_preview_url,alt:"Image",width:"250",preview:""},null,8,["src"])])):_("",!0),e.warning_comment?(n(),v("div",Ze,f(e.warning_comment.text),1)):_("",!0)]}),_:1},8,["header"])):_("",!0),l(S,{class:"min-w-[200px]",header:"Tipo",field:"warning_type",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!0},{filter:m(({filterModel:e,filterCallback:d})=>[l(P,{class:"w-[200px]",modelValue:e.value,"onUpdate:modelValue":[i=>e.value=i,d],options:k.value,"option-label":"labels.it","option-value":"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),body:m(({data:e})=>[e.warning_video_id?(n(),v("div",et,f(c(g).getPrettyVideoWarningTypes(e.warning_type+"")),1)):e.warning_user_id?(n(),v("div",tt,f(c(g).getPrettyUserWarningTypes(e.warning_type+"")),1)):(n(),v("div",ot,f(c(g).getPrettyCommentWarningTypes(e.warning_type+"")),1))]),_:1}),l(S,{class:"min-w-[100px]",header:"Data apertura",field:"created_at",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!0},{filter:m(({filterModel:e,filterCallback:d})=>[l(ve,{modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,dateFormat:"dd/mm/yy",placeholder:"Filtra",onDateSelect:i=>d()},null,8,["modelValue","onUpdate:modelValue","onDateSelect"])]),body:m(({data:e})=>[y(f(c(J)(e.created_at)),1)]),_:1}),l(S,{class:"min-w-[200px]","filter-field":"user_id",header:"Utente segnalatore",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!0},{filter:m(({filterModel:e,filterCallback:d})=>[l(oe,{modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,optionLabel:"full_name",optionValue:"id",suggestions:D.value,onComplete:Y,onOptionSelect:i=>d(),dataKey:"id",onClear:i=>d()},null,8,["modelValue","onUpdate:modelValue","suggestions","onOptionSelect","onClear"])]),body:m(({data:e})=>{var d,i,q;return[r("div",{class:"flex items-center gap-2 cursor-pointer",onClick:H=>{var K;return te(((K=e==null?void 0:e.user)==null?void 0:K.id)??"")}},[(d=e.user)!=null&&d.profile_picture_url?(n(),$(R,{key:0,image:(i=e.user)==null?void 0:i.profile_picture_url,style:{width:"32px"},shape:"circle"},null,8,["image"])):e.user?(n(),$(R,{key:1,class:"mr-2 text-sm!",size:"width: 32px",shape:"circle"})):_("",!0),r("span",null,f((q=e.user)==null?void 0:q.full_name),1)],8,at)]}),_:1}),l(S,{class:"min-w-[100px]",header:"Stato",field:"open",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!0},{filter:m(({filterModel:e,filterCallback:d})=>[l(P,{class:"w-[100px]",modelValue:e.value,"onUpdate:modelValue":[i=>e.value=i,d],options:X.value,"option-label":"label","option-value":"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),body:m(({data:e})=>[l(fe,{value:c(g).getPrettyWarningStatus(e.open),severity:c(g).getColorVideoStatus(!e.open)},null,8,["value","severity"])]),_:1}),l(S,{class:"w-[50px]","align-frozen":"right",frozen:""},{body:m(({data:e})=>[r("div",st,[e.open?ie((n(),$(ae,{key:0,type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-lock",text:"",rounded:"",severity:"secondary",onClick:d=>ce(e.id)},null,8,["onClick"])),[[se,"Chiudi segnalazione",void 0,{top:!0}]]):(n(),v("div",lt))])]),_:1}),l(S,{class:"w-[50px]","align-frozen":"right",frozen:""},{body:m(({data:e})=>[r("div",it,[ie(l(ae,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-arrow-right",text:"",rounded:"",onClick:d=>me(e)},null,8,["onClick"]),[[se,"Dettaglio",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","total-records","onSort","onPage","filters","loading"])]),l(Ke,{item:U.value,visible:M.value,"onUpdate:visible":u[3]||(u[3]=e=>M.value=e)},null,8,["item","visible"])],64)}}});export{ft as _,Ee as s};
