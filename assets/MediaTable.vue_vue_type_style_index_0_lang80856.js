import{d as R,j,r as h,y as G,b as H,z as W,o as F,c as S,a as i,f as o,u as s,C as J,w as l,k as X,l as Y,n as Z,t as w,q as ee,v as te,x as oe,T as ae}from"../index80856.js";import{u as se,T as p,L as le,a as ne,s as re,b as ie}from"./LazyDataTable80856.js";import{s as ue,a as de}from"./index808567.js";import{s as ce}from"./index808564.js";import{u as pe}from"./media80856.js";import{u as me}from"./settings80856.js";import{u as fe}from"./user80856.js";import{a as _e}from"./date80856.js";const ve={key:0,class:"flex flex-col mb-8"},he={class:"crop"},we={class:"flex items-center gap-x-2"},ge={class:"flex items-center gap-2"},ye={class:"flex items-center gap-2"},be={class:"flex items-center justify-center"},C=10,$e=R({__name:"MediaTable",props:{user_id:{},contest_id:{}},setup(T){const u=T,g=pe(),m=me(),y=fe(),{medias:U,totalMedias:$}=j(g),{onSort:D,onPage:L,onFilter:q,loadLazyData:b,isLoading:z}=se({rows:C},k),f=h(),_=m.getVideoCategories(),M=G(()=>y.users),v=h(),c=h({id:{value:"",matchMode:p.EQ},online:{value:"",matchMode:p.EQ},created_at:{value:null,matchMode:p.EQ},user_id:{value:"",matchMode:p.EQ},title:{value:"",matchMode:p.LIKE}});function O(){q(c.value)}async function k(t){u.contest_id?t.set("contest_id_eq",u.contest_id):t.set("category_eq",f.value),c.value.user_id.value&&t.set("user_id_eq",c.value.user_id.value.id),u.user_id&&t.set("user_id_eq",u.user_id);try{await g.fetchMedias(t)}catch(a){console.error(a)}}const E=function(t){return{name:te.mediaDettaglio,params:{id:t}}};async function N(){try{const t=new Map;t.set("page",1),t.set("limit",1e3),await y.fetchUsers(t)}catch(t){console.error(t)}}const K=t=>{setTimeout(()=>{t.query.trim().length?v.value=M.value.filter(a=>a.full_name.toLowerCase().startsWith(t.query.toLowerCase())):v.value=[...M]},250)};return H(()=>{_&&_.length>0&&!u.contest_id&&(f.value=_[0].value),N()}),W(()=>[u.user_id,u.contest_id],()=>{b()},{immediate:!0}),(t,a)=>{const V=ne,B=ue,d=re,I=ce,x=oe,P=de,Q=ie,A=ae;return F(),S("div",null,[t.contest_id?J("",!0):(F(),S("div",ve,[a[2]||(a[2]=i("label",{for:"notifications_type",class:"text-muted-color font-500 mb-1"},"Categoria",-1)),o(V,{modelValue:f.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>f.value=e),s(b)],options:s(_),"option-label":"labels.it","option-value":"value",class:"w-full md:w-60"},null,8,["modelValue","options","onUpdate:modelValue"])])),o(le,{value:s(U),rows:C,"total-records":s($),onSort:s(D),onPage:s(L),onFilter:O,filters:c.value,"onUpdate:filters":a[1]||(a[1]=e=>c.value=e),"data-key":"id",scrollable:"",loading:s(z),rowHover:!0,showGridlines:""},{empty:l(()=>a[3]||(a[3]=[X("Non ci sono media")])),default:l(()=>[o(d,{class:"max-w-[100px]",header:"Media",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{body:l(({data:e})=>[i("div",he,[o(B,{src:e.attachment_img_preview_url,alt:"Image",width:"250",preview:""},null,8,["src"])])]),_:1}),o(d,{class:"min-w-[200px]",header:"Titolo",field:"title",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{filter:l(({filterModel:e,filterCallback:n})=>[i("div",we,[o(I,{fluid:"",modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,type:"text",placeholder:"Filtra",onKeydown:Y(r=>n(),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeydown"]),o(x,{class:Z(e.value?"":"invisible"),icon:"pi pi-filter-slash",variant:"text",rounded:"",onClick:r=>{e.value="",n()}},null,8,["class","onClick"])])]),body:l(({data:e})=>[i("div",ge,[i("span",null,w(e.title),1)])]),_:1}),o(d,{class:"min-w-[200px]",header:"Autore",field:"user_id",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!0},{filter:l(({filterModel:e,filterCallback:n})=>[o(P,{modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,optionLabel:"full_name",optionValue:"id",suggestions:v.value,onComplete:K,onOptionSelect:r=>n(),dataKey:"id",onClear:r=>n()},null,8,["modelValue","onUpdate:modelValue","suggestions","onOptionSelect","onClear"])]),body:l(({data:e})=>{var n;return[i("div",ye,[i("span",null,w((n=e.user)==null?void 0:n.full_name),1)])]}),_:1}),o(d,{header:"Data caricamento",field:"created_at",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!0},{body:l(({data:e})=>[i("span",null,w(s(_e)(e.created_at)),1)]),_:1}),o(d,{class:"min-w-[100px]",header:"Stato",field:"online",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!0},{filter:l(({filterModel:e,filterCallback:n})=>[o(V,{class:"w-[200px]",modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,n],options:s(m).getVideoStatus(),"option-label":"label","option-value":"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),body:l(({data:e})=>[o(Q,{value:s(m).getPrettyVideoStatus(e.online),severity:s(m).getColorVideoStatus(e.online)},null,8,["value","severity"])]),_:1}),o(d,{class:"w-[50px]","align-frozen":"right",frozen:""},{body:l(({data:e})=>[i("div",be,[ee(o(x,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-arrow-right",text:"",rounded:"",as:"router-link",to:E(e.id)},null,8,["to"]),[[A,"Dettaglio",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","total-records","onSort","onPage","filters","loading"])])}}});export{$e as _};
